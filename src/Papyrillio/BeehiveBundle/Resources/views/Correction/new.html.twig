{% extends '::base.html.twig' %}

{% block body %}

<h3>Neue Berichtigung</h3>
<form id="correctionNew" class="new" action="{{ path('PapyrillioBeehiveBundle_correctionnew') }}" method="post" {{ form_enctype(form) }}>
    {{ form_errors(form) }}

    <div>
        <label>Band</label>
        <select name="compilation">        
        {% for compi in compilations %}
          <option value="{{ compi.id }}" {{ compi.id == form.vars.value.compilation.id ? 'selected="selected"' : '' }}>{{ compi.title }}</option>
        {% endfor %}
        </select>
    </div>
    <div>
        <label>BL_Ed_Nr</label>
        <select name="editionSort" id="editionSort">        
        {% for edi in editions %}
          <option value="{{ edi.id }}" {{ edi.id == form.vars.value.edition.id ? 'selected="selected"' : '' }}>{{ edi.sort }}</option>
        {% endfor %}
        </select>
    </div>
    <div>
        <label>Edition</label>
        <select name="edition" id="editionTitle">
        {% for edi in editions %}
          <option value="{{ edi.id }}" {{ edi.id == form.vars.value.edition.id ? 'selected="selected"' : '' }}>{{ edi.title }}</option>
        {% endfor %}
        </select>
    </div>
    
    <div class="text">
      {{ form_label(form.text) }}
      {{ form_widget(form.text) }}
      {{ form_errors(form.text) }}
    </div>
    
    <div class="position">
      {{ form_label(form.position) }}
      {{ form_widget(form.position) }}
      {{ form_errors(form.position) }}
    </div>
    
    <div class="description">
      {{ form_label(form.description) }}
      {{ form_widget(form.description, { 'attr': { 'class': 'greek' } }) }}
      {{ form_errors(form.description) }}
    </div>
    
    <h5>Aufgaben definieren</h5>
    {% for task in ['bl', 'hgv', 'tm', 'ddb', 'apis', 'biblio'] %}
      <div class="task {{ task }} greek">
        <label>{{ task | upper }}</label>
        <input name="task[{{ task }}]" id="task_{{ task }}" type="text" />
      </div>
    {% endfor %}
    
    <div class="idno">
    {{ form_rest(form) }}
    </div>

    <input class="submit" type="submit" name="new" value="Datensatz anlegen" />
</form>

{% endblock %}

{% block javascripts %}
  {{ parent() }}
  
  <script src="{{ asset('js/jquery/jquery-specialedit.hacked.js') }}" type="text/javascript"></script>
  <script src="{{ asset('js/correction.js') }}" type="text/javascript"></script>

  <script type="text/javascript">
  
  $(document).ready(function(){
    $('#form_position').specialedit(['R°', 'V°']);
    $('#editionTitle').change(function(event){
      $('#editionSort').val(this.value);
      if(this.value == 1){
        $('#form_tm').removeAttr('required');
        $('#form_hgv').removeAttr('required');
        $('#form_ddb').removeAttr('required');
      } else {
        $('#form_tm').attr('required', 'required');
        $('#form_hgv').attr('required', 'required');
        $('#form_ddb').attr('required', 'required');
      }
    });

    $('#editionSort').change(function(event){
      $('#editionTitle').val(this.value);
      if(this.value == 1){
        $('#form_tm').removeAttr('required');
        $('#form_hgv').removeAttr('required');
        $('#form_ddb').removeAttr('required');
      } else {
        $('#form_tm').attr('required', 'required');
        $('#form_hgv').attr('required', 'required');
        $('#form_ddb').attr('required', 'required');
      }
    });
    
    $('#form_tm').change(function(event){
      numberWizard($(this).val(), '{{ path('PapyrillioBeehiveBundle_numberwizard') }}');
    });

    $('#form_hgv').change(function(event){
      numberWizard($(this).val(), '{{ path('PapyrillioBeehiveBundle_numberwizard') }}');
    });

    $('#form_ddb').change(function(event){
      numberWizard($(this).val(), '{{ path('PapyrillioBeehiveBundle_numberwizard') }}');
    });

    $('#form_text').change(function(event){
      numberWizard($(this).val(), '{{ path('PapyrillioBeehiveBundle_numberwizardlookup') }}');
    });

  });
  
  </script>
{% endblock %}