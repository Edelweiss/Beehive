{% extends '::base.html.twig' %}

{% block body %}
<h3>{{ correction.title }}, <span id="position" class="edit">{{ correction.position }}</span></h3>
<div id="correction">
  <h4><a href="#">Korrektur</a></h4>
  <div><p id="description" class="editArea">{{ correction.description }}</p></div>
  <h4><a href="#">Aufgaben</a></h4>
  <div>
    <ul class="task">
      {% for task in correction.tasks %}
        <li>{{ task.title }}: <span id="task_{{ task.id }}_description" class="editTask">{{ task.description }}</span> <span id="task_{{ task.id }}_cleared" class="editTaskSelect highlight">{{ task.isCleared ? '✔' : '✘' }}</span></li>
      {% endfor %}
    </ul>
  </div>
  <h4><a href="#">Weitere Quellen</a></h4>
  <div>
    {{ correction.bl }} / {{ correction.edition }} {{ correction.text }} = TM {{ correction.tm }} = HGV {{ correction.hgv }} = DDB {{ correction.ddb }}
    <ul class="links">
      {% for name,link in correction.links %}
        <li><a href="{{ link }}" target="_blank">{{ name }}</a></li>
      {% endfor %}
    </ul>
  </div>
  <h4><a href="#">Versionslogbuch</a></h4>
  <div class="log">
    <ul class="logs">
      {% for log in logs %}
        <li>Version {{ log.version }} / {{ log.loggedAt.format('Y-m-d H:i:s') }}: {{ log.action }} ({{ log.username }})
          <ul>
            {% for key,value in log.data %}
              <li>{{ key }} → 
              
              {{ value }}
              </li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>

<p class="actionHolder">
  <a href="{{ path('PapyrillioBeehiveBundle_correctiondelete', { 'id': correction.id}) }}" onclick="javascript: return confirm('Eintrag wirklich unwiederbringlich aus der Datenbank entfernen?');">Eintrag löschen</a>
</p>

{% block javascripts %}
  {{ parent() }}
  
  <script src="{{ asset('js/jquery/jquery-jeditable.min.js') }}" type="text/javascript"></script>

  <script type="text/javascript">
  
  jQuery(document).ready(function(){
    $('#correction').accordion({
      autoHeight: true
    });
    $('.edit').editable('{{ path('PapyrillioBeehiveBundle_correctionupdate', {'id': correction.id}) }}', {
      id   : 'elementid',
      name : 'newvalue',
      indicator : 'Speichert...',
      tooltip   : 'Klicken zum Editieren...',
      style: 'inherit'
    });
    $('.editArea').editable('{{ path('PapyrillioBeehiveBundle_correctionupdate', {'id': correction.id}) }}', {
      id   : 'elementid',
      name : 'newvalue',
      type: 'textarea',
      cancel: 'Abbrechen',
      submit: 'OK',
      //indicator: '<img src="{{ asset('images/spinner.gif') }}" />',
      indicator : 'Speichert...',
      tooltip   : 'Klicken zum Editieren...'
    });
    $('.editTask').editable('{{ path('PapyrillioBeehiveBundle_taskupdate', {'id': 0}) }}', {
      id   : 'elementid_raw',
      name : 'newvalue',
      submitdata: function(value, settings){
          settings.target = settings.target.substring(0, settings.target.length - 1) + this.id.match(/^task_(\d+)_(\w+)$/)[1];
          return {elementid: this.id.match(/^task_(\d+)_(\w+)$/)[2]};
      },
      indicator : 'Speichert...',
      tooltip   : 'Klicken zum Editieren...',
      style: 'inherit'
    });
    $('.editTaskSelect').editable('{{ path('PapyrillioBeehiveBundle_taskupdate', {'id': 0}) }}', {
      id   : 'elementid_raw',
      name : 'newvalue',
      submitdata: function(value, settings){
          settings.target = settings.target.substring(0, settings.target.length - 1) + this.id.match(/^task_(\d+)_(\w+)$/)[1];
          return {elementid: this.id.match(/^task_(\d+)_(\w+)$/)[2]};
      },
      indicator : 'Speichert...',
      tooltip   : 'Klicken zum Editieren...',
      type: 'select',
      data: {'✔': 'erledigt', '✘': 'offen'},
      style: 'inherit',
      submit: 'OK'
    });
  });
  
  </script>
{% endblock %}


{% endblock %}
